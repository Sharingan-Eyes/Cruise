<div class="container">
    <ng-container *ngIf="{ isLoading: isLoading$ | async } as data">
        <ng-template #content>
            <ng-container
                *ngIf="reportingTableData$ | async as reportingTableData"
            >
                <div class="header-row">
                    <h1>Sales And Report</h1>
                    <ng-container *ngIf="cruiseLines$ | async as cruiseLines">
                        <div class="group">
                            <button
                                (click)="openUploadFileModal()"
                                pButton
                                class="btn btn-primary"
                                [appPermission]="{
                            features: [{

                                feature: features.inventoryManagement.name,
                                page: features.inventoryManagement.pages
                                    .salesAndReports.name,
                                pageFeature: [
                                    features.inventoryManagement.pages
                                        .salesAndReports.features
                                        .uploadFiles.name,
                                ],
                                pageFeatureCheck: 'or',
                            }],
                            mode: 'none',
                        }"
                            >
                                <i class="pi pi-plus"></i>
                                Upload Files
                            </button>
                            <p-dropdown
                                [options]="cruiseLines"
                                optionLabel="shipCompanyName"
                                optionValue="shipCompanyId"
                                placeholder="Select Cruise Line"
                                (onChange)="onCruiseLineChange()"
                                [(ngModel)]="selectedCruise"
                            ></p-dropdown>
                        </div>
                    </ng-container>
                </div>

                <ng-container *ngIf="reportingTableData.fileHeaders">
                    <div class="report-item">
                        <div class="report-header">
                            <h3>File Header Mapping</h3>
                            <button
                                (click)="openAddNewReportModal()"
                                pButton
                                class="btn btn-primary"
                                [appPermission]="{
                            features: 
                            [{feature: features.inventoryManagement.name,
                            page: features.inventoryManagement.pages
                                .salesAndReports.name,
                            pageFeature: [
                                features.inventoryManagement.pages
                                    .salesAndReports.features
                                    .fileHeaderMappingCreate.name,
                            ],
                            pageFeatureCheck: 'or',}],
                            mode: 'none',
                        }"
                            >
                                <i class="pi pi-plus"></i>
                                Add New
                            </button>
                        </div>
                        <app-sales-report-table
                            [tableData]="reportingTableData.fileHeaders || []"
                        ></app-sales-report-table>
                    </div>
                </ng-container>
                <ng-container *ngIf="reportingTableData.shipReports">
                    <div class="report-item">
                        <div class="report-header">
                            <h3>Ship Mapping</h3>
                            <button
                                (click)="openAddNewShipModal()"
                                pButton
                                class="btn btn-primary"
                                [appPermission]="{
                            features: [{

                                feature: features.inventoryManagement.name,
                                page: features.inventoryManagement.pages
                                    .salesAndReports.name,
                                pageFeature: [
                                    features.inventoryManagement.pages
                                        .salesAndReports.features
                                        .shipMappingCreate.name,
                                ],
                                pageFeatureCheck: 'or',
                            }],
                            mode: 'none',
                        }"
                            >
                                <i class="pi pi-plus"></i>
                                Add New
                            </button>
                        </div>
                        <app-ship-table
                            [tableData]="reportingTableData.shipReports || []"
                        ></app-ship-table>
                    </div>
                </ng-container>
                <ng-container *ngIf="reportingTableData.portReports">
                    <div class="report-item">
                        <div class="report-header">
                            <h3>Port Mapping</h3>
                            <button
                                (click)="openAddNewPortModal()"
                                pButton
                                class="btn btn-primary"
                                [appPermission]="{
                            features: [{

                                feature: features.inventoryManagement.name,
                                page: features.inventoryManagement.pages
                                    .salesAndReports.name,
                                pageFeature: [
                                    features.inventoryManagement.pages
                                        .salesAndReports.features
                                        .portMappingCreate.name,
                                ],
                                pageFeatureCheck: 'or',
                            }],
                            mode: 'none',
                        }"
                            >
                                <i class="pi pi-plus"></i>
                                Add New
                            </button>
                        </div>
                        <app-port-table
                            [tableData]="reportingTableData.portReports || []"
                        ></app-port-table>
                    </div>
                </ng-container>
                <ng-container *ngIf="reportingTableData.tourReports">
                    <div class="report-item">
                        <div class="report-header">
                            <h3>Tour Mapping</h3>
                            <button
                                (click)="openAddNewTourModal()"
                                pButton
                                class="btn btn-primary"
                                [appPermission]="{
                            features: [{

                                feature: features.inventoryManagement.name,
                                page: features.inventoryManagement.pages
                                    .salesAndReports.name,
                                pageFeature: [
                                    features.inventoryManagement.pages
                                        .salesAndReports.features
                                        .tourMappingCreate.name,
                                ],
                                pageFeatureCheck: 'or',
                            }],
                            mode: 'none',
                        }"
                            >
                                <i class="pi pi-plus"></i>
                                Add New
                            </button>
                        </div>
                        <app-tour-table
                            [tableData]="reportingTableData.tourReports || []"
                        ></app-tour-table>
                    </div>
                </ng-container>
            </ng-container>
        </ng-template>
        <ng-container *ngIf="data.isLoading; else content">
            <app-loader-embed [isDisplayed]="true"></app-loader-embed>
        </ng-container>
    </ng-container>
</div>

<!-- modals -->
<app-add-new-file-header></app-add-new-file-header>
<app-remove-file-report-header></app-remove-file-report-header>
<app-edit-file-report-header></app-edit-file-report-header>
<app-add-new-ship></app-add-new-ship>
<app-remove-ship></app-remove-ship>
<app-edit-ship></app-edit-ship>
<app-add-new-port></app-add-new-port>
<app-remove-port></app-remove-port>
<app-edit-port></app-edit-port>
<app-add-new-tour></app-add-new-tour>
<app-remove-tour></app-remove-tour>
<app-edit-tour></app-edit-tour>
<app-file-upload></app-file-upload>
