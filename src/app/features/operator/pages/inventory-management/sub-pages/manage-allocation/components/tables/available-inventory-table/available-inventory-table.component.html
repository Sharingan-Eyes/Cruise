<ng-container *ngIf="manageAllocationInventories$ | async as config">
    <div class="table-container">
        <ng-container
            *ngIf="config.data && config.data.length > 0; else emptyState"
        >
            <p-table
                [value]="config.data"
                styleClass="available-inventory-table"
                [scrollable]="true"
                [tableStyle]="{ width: '100%', 'min-width': '50rem' }"
                dataKey="bookingId"
                [rows]="50"
                [rowsPerPageOptions]="[50, 100, 200]"
                [paginator]="true"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Ship</th>
                        <th>Port</th>
                        <th>Tour</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Sold</th>
                        <th>Capacity</th>
                        <th>Time</th>
                        <th alignFrozen="right" pFrozenColumn>Action</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item>
                    <tr>
                        <td>
                            <ng-container
                                *ngIf="
                                    item.isReleased === false &&
                                        item.shipId === null;
                                    else cruiseInfo
                                "
                            >
                                <!-- unallocated -->
                                -
                            </ng-container>
                            <ng-template #cruiseInfo>
                                {{ item.cruiseShipName }}
                            </ng-template>
                        </td>
                        <td>{{ item.portName || '-' }}</td>
                        <td>{{ item.tourName }}</td>
                        <td>
                            <app-inventory-status-chip
                                [tourInventory]="item"
                            ></app-inventory-status-chip>
                        </td>
                        <td>{{ item.start | date : 'MM/dd/yyyy' }}</td>
                        <td>{{ item.seatsSold }}</td>
                        <td>{{ item.capacity }}</td>
                        <td>{{ item.start | date : 'hh:mm a' }}</td>
                        <ng-container
                            *ngIf="item.isReleased === false; else released"
                        >
                            <td alignFrozen="right" pFrozenColumn>
                                <div class="action-column">
                                    <ng-container
                                        *ngIf="item.isReleased === false"
                                    >
                                        <ng-container
                                            *ngIf="
                                                item.shipId === null;
                                                else releaseButton
                                            "
                                        >
                                            <button
                                                pButton
                                                class="btn btn-primary"
                                                (click)="
                                                    openAllocateInventoryModal(
                                                        item
                                                    )
                                                "
                                                [appPermission]="{
                                                    features: [{

                                                        feature: features.inventoryManagement.name,
                                                        page: features.inventoryManagement.pages
                                                            .manageAllocation.name,
                                                        pageFeature: [
                                                        features.inventoryManagement.pages
                                                        .manageAllocation.features.allocateInventory.name
                                                        ],
                                                        pageFeatureCheck: 'or',
                                                    }],
                                                    mode: 'none',
                                                }"
                                            >
                                                Allocate
                                            </button>
                                        </ng-container>
                                        <ng-template #releaseButton>
                                            <button
                                                pButton
                                                class="btn btn-primary"
                                                (click)="
                                                    openReleaseInventoryModal(
                                                        item
                                                    )
                                                "
                                                [appPermission]="{
                                                    features: [{

                                                        feature: features.inventoryManagement.name,
                                                        page: features.inventoryManagement.pages
                                                            .manageAllocation.name,
                                                        pageFeature: [
                                                        features.inventoryManagement.pages
                                                        .manageAllocation.features.releaseInventory.name
                                                        ],
                                                        pageFeatureCheck: 'or',
                                                    }],
                                                    mode: 'none',
                                                }"
                                            >
                                                Release
                                            </button>
                                        </ng-template>
                                        <button
                                            pButton
                                            class="btn btn-primary-inverse"
                                            (click)="
                                                openEditInventoryModal(item)
                                            "
                                            [appPermission]="{
                                                features: [{

                                                    feature: features.inventoryManagement.name,
                                                    page: features.inventoryManagement.pages
                                                        .manageAllocation.name,
                                                    pageFeature: [
                                                    features.inventoryManagement.pages
                                                    .manageAllocation.features.editInventory.name
                                                    ],
                                                    pageFeatureCheck: 'or',
                                                }],
                                                mode: 'none',
                                            }"
                                        >
                                            Edit
                                        </button>
                                        <button
                                            pButton
                                            class="btn btn-danger"
                                            (click)="
                                                openRemoveInventoryModal(item)
                                            "
                                            [appPermission]="{
                                                features: [{

                                                    feature: features.inventoryManagement.name,
                                                    page: features.inventoryManagement.pages
                                                        .manageAllocation.name,
                                                    pageFeature: [
                                                    features.inventoryManagement.pages
                                                    .manageAllocation.features.deleteInventory.name
                                                    ],
                                                    pageFeatureCheck: 'or',
                                                }],
                                                mode: 'none',
                                            }"
                                        >
                                            Delete
                                        </button>
                                    </ng-container>
                                </div>
                            </td>
                        </ng-container>
                        <ng-template #released>
                            <td>No Action Required</td>
                        </ng-template>
                    </tr>
                </ng-template>
            </p-table>
        </ng-container>
        <ng-template #emptyState>
            <div class="empty-state-container">
                <h3>No Available Inventories</h3>
                <span>Try a different search</span>
            </div>
        </ng-template>
    </div>
</ng-container>
<app-table-allocate-selected-inventory-modal></app-table-allocate-selected-inventory-modal>
<app-table-delete-selected-inventory-modal></app-table-delete-selected-inventory-modal>
<app-table-edit-selected-allocated-inventory-modal></app-table-edit-selected-allocated-inventory-modal>
<app-table-edit-selected-unallocated-inventory-modal></app-table-edit-selected-unallocated-inventory-modal>
<app-table-release-selected-inventory-modal></app-table-release-selected-inventory-modal>
