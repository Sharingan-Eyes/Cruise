<ng-container
    *ngIf="{
        isOpen: (isOpen$ | async) || false,
        status: status$ | async
    } as data"
>
    <p-dialog
        [(visible)]="data.isOpen"
        (onHide)="close()"
        [modal]="true"
        [style]="{ width: '60vw', height: 'auto' }"
        styleClass="form-dialog"
        [breakpoints]="{ '768px': '95vw' }"
        [showHeader]="false"
        [draggable]="false"
        [resizable]="false"
        [dismissableMask]="true"
        appendTo="body"
    >
        <div class="modal-inner-container">
            <div class="modal-header">
                <h2>Check In</h2>
                <button class="btn btn-text btn-close" (click)="close()">
                    <i class="pi pi-times"></i>
                </button>
            </div>
            <ng-container [ngSwitch]="stage">
                <ng-container *ngSwitchCase="'scan'">
                    <ng-container *ngIf="data.isOpen">
                        <div class="scan-container">
                            <span
                                >Align the QR code within the frame to
                                scan</span
                            >
                            <span class="camera-container">
                                <zxing-scanner
                                    [enable]="scannerEnabled"
                                    [formats]="allowedFormats"
                                    (scanSuccess)="onScanSuccess($event)"
                                ></zxing-scanner>
                            </span>
                        </div>
                        <!-- [torch]="torch"
            (torchCompatible)="onTorchCompatible($event)"
            (camerasFound)="camerasFoundHandler($event)"
            (camerasNotFound)="camerasNotFoundHandler($event)"
            (scanSuccess)="scanSuccessHandler($event)"
            (scanError)="scanErrorHandler($event)"
            (scanFailure)="scanFailureHandler($event)"
            (scanComplete)="scanCompleteHandler($event)" -->
                    </ng-container>
                </ng-container>
                <ng-container *ngSwitchCase="'checkinLoading'">
                    <div class="checkin-loading-container">
                        <span class="h5">Checking-in Guest</span>
                        <app-loader-embed
                            [isDisplayed]="true"
                        ></app-loader-embed>
                        <span class="body-m">Please Wait...</span>
                    </div>
                </ng-container>
                <ng-container *ngSwitchCase="'checkinSuccess'">
                    <div class="checkin-success-container">
                        <ng-container
                            *ngIf="bookingDetails$ | async as bookingDetails"
                        >
                            <div class="guest-details-container">
                                <span class="h5">Checked-in</span>
                                <i class="pi pi-check-circle"></i>
                                <div class="guest-container">
                                    <span class="h4">{{
                                        bookingDetails.name | titlecase
                                    }}</span>
                                    <span class="body-m"
                                        >{{ bookingDetails.time }}
                                        {{ bookingDetails.tourName }}</span
                                    >
                                </div>
                                <!-- TODO: include book direct/ship guest? -->
                                <!-- <span class="h5">{{
                                bookingDetails.shipName
                            }}</span> -->
                            </div>
                            <button
                                pButton
                                class="btn btn-text-primary"
                                (click)="reset()"
                            >
                                Check-in another guest
                            </button>
                        </ng-container>
                    </div>
                </ng-container>
                <ng-container *ngSwitchCase="'checkinError'">
                    <div class="checkin-error-container">
                        <div class="error-details-container">
                            <span class="h5">Unable to check-in guest</span>
                            <i class="pi pi-exclamation-circle"></i>
                            <span class="body-m"
                                >Try manually checking-in guest via the Daily
                                Tour Dispatch</span
                            >
                        </div>
                        <button
                            pButton
                            class="btn btn-text-primary"
                            (click)="reset()"
                        >
                            Check-in another guest
                        </button>
                    </div>
                </ng-container>
            </ng-container>
        </div>
    </p-dialog>
</ng-container>
