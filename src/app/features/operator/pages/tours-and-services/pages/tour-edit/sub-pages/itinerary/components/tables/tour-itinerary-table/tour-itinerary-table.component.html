<ng-container
    *ngIf="{
        status: status$ | async,
        allowReorder: allowReorder$ | async
    } as data"
>
    <div class="itinerary-table-container">
        <ng-container *ngIf="tourItineraryList">
            <p-table
                [value]="tourItineraryList || []"
                [scrollable]="true"
                styleClass="itinerary-table"
                [reorderableColumns]="data.allowReorder"
                (onRowReorder)="reorderRow($event)"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Order No</th>
                        <th>Description</th>
                        <th>Transportation</th>
                        <th>Duration</th>
                        <th
                            alignFrozen="right"
                            pFrozenColumn
                            class="action"
                            [appPermission]="{
                            features: [{
                                feature:
                                    features.toursAndServicesEdit.name,
                                page: features.toursAndServicesEdit.pages
                                    .itinerary.name,
                                pageFeature: [
                                    features.toursAndServicesEdit.pages
                                        .itinerary
                                        .features.deleteItinerary.name,
                                        features.toursAndServicesEdit.pages
                                        .itinerary
                                        .features.editItinerary.name,
                                        
                                ],
                                pageFeatureCheck: 'or',
                            }],
                            mode: 'none'
                        }"
                        >
                            Action
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item let-index="rowIndex">
                    <tr [pReorderableRow]="index">
                        <td class="order-td">
                            <div class="order-wrapper">
                                <span
                                    class="pi pi-bars"
                                    style="font-size: 1.25rem"
                                    pReorderableRowHandle
                                    [appPermission]="{
                                        features: [{
                                            feature:
                                                features.toursAndServicesEdit.name,
                                            page: features.toursAndServicesEdit.pages
                                                .itinerary.name,
                                            pageFeature: [
                                                    features.toursAndServicesEdit.pages
                                                    .itinerary
                                                    .features.reorderItinerary.name
                                            ],
                                        }],
                                        mode: 'none'
                                    }"
                                ></span>
                                <div class="order-num-content">
                                    <ng-container
                                        *ngIf="index !== 0; else notFirst"
                                    >
                                        <div class="vertical-line"></div>
                                    </ng-container>
                                    <ng-template #notFirst>
                                        <div class="vertical-line first"></div>
                                    </ng-template>
                                    <span class="order-num">
                                        {{ index + 1 }}
                                    </span>
                                    <div class="vertical-line"></div>
                                </div>
                            </div>
                        </td>
                        <td>{{ item.description }}</td>
                        <td>{{ item.transportationType }}</td>
                        <td>
                            {{ item.time }}
                        </td>
                        <td
                            alignFrozen="right"
                            pFrozenColumn
                            class="action"
                            [appPermission]="{
                            features: [{
                                feature:
                                    features.toursAndServicesEdit.name,
                                page: features.toursAndServicesEdit.pages
                                    .itinerary.name,
                                    pageFeature: [
                                    features.toursAndServicesEdit.pages
                                        .itinerary
                                        .features.deleteItinerary.name,
                                        features.toursAndServicesEdit.pages
                                        .itinerary
                                        .features.editItinerary.name,
                                        
                                ],
                                pageFeatureCheck: 'or',
                            }],
                            mode: 'none'
                        }"
                        >
                            <div class="action-column">
                                <button
                                    pButton
                                    class="btn btn-light-gray"
                                    pTooltip="Edit"
                                    tooltipPosition="left"
                                    (click)="openEditTourPriceModal(item)"
                                    [appPermission]="{
                                        features: [{
                                            feature:
                                                features.toursAndServicesEdit.name,
                                            page: features.toursAndServicesEdit.pages
                                                .itinerary.name,
                                            pageFeature: [
                                                features.toursAndServicesEdit.pages
                                                    .itinerary
                                                    .features.editItinerary.name,
                                            ],
                                        }],
                                        mode: 'none'
                                    }"
                                >
                                    <i class="pi pi-pencil"></i>
                                </button>
                                <button
                                    pButton
                                    class="btn btn-red"
                                    pTooltip="Delete"
                                    tooltipPosition="left"
                                    (click)="openRemoveTourPriceModal(item)"
                                    [appPermission]="{
                                        features: [{
                                            feature:
                                                features.toursAndServicesEdit.name,
                                            page: features.toursAndServicesEdit.pages
                                                .itinerary.name,
                                            pageFeature: [
                                                    features.toursAndServicesEdit.pages
                                                    .itinerary
                                                    .features.deleteItinerary.name
                                            ],
                                        }],
                                        mode: 'none'
                                    }"
                                >
                                    <i class="pi pi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </ng-container>
    </div>
    <div class="btn-container">
        <ng-container *ngIf="data.status === 'error'">
            <div>
                <span class="text-error">Failed to update tour itinerary</span>
            </div>
        </ng-container>
        <ng-container *ngIf="data.status === 'success'">
            <div>
                <span class="text-success">Tour itinerary updated</span>
            </div>
        </ng-container>
        <button
            pButton
            class="btn btn-primary"
            (click)="saveReorderedRowIndexes()"
            [loading]="data.status === 'loading'"
            [appPermission]="{
                features: [{
                    feature:
                        features.toursAndServicesEdit.name,
                    page: features.toursAndServicesEdit.pages
                        .itinerary.name,
                    pageFeature: [
                            features.toursAndServicesEdit.pages
                            .itinerary
                            .features.reorderItinerary.name
                    ],
                }],
                mode: 'none'
            }"
        >
            Save
        </button>
    </div>
</ng-container>
